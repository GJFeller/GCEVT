<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" ng-app="myApp" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en" ng-app="myApp" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en" ng-app="myApp" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" ng-app="myApp" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My AngularJS App</title>
  <meta name="description" content="">
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap-theme.css">
  <link rel="stylesheet" href="app.css">
  <link rel="stylesheet" href="iris-list/d3-vis/parcoord.css">
  <link rel="stylesheet" href="iris-list/d3-vis/splotMatrix.css">
  <link rel="stylesheet" href="iris-list/d3-vis/lineChart.css">
  <link rel="stylesheet" href="bower_components/jquery-ui/themes/base/jquery-ui.css">

  <script src="bower_components/jquery/dist/jquery.min.js"></script>
  <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="http://jonmiles.github.io/bootstrap-treeview/js/bootstrap-treeview.js"></script>

    <link rel="stylesheet" href="bower_components/fancytree/dist/skin-bootstrap/ui.fancytree.css" class="skinswitcher">

</head>
<body>
  <!--<ul class="menu">
    <li><a href="#!/view1">view1</a></li>
    <li><a href="#!/view2">view2</a></li>
  </ul>!-->

  <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
  <![endif]-->


  <!--<div parcoord bar-height="20" bar-padding="5"></div>!-->

  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Geochemical Ensemble Visualization Tool</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#">Visualization</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div ng-controller="IrisCtrl" id="ctrl">
      <div class="container-fluid">
          <!--<h2>---</h2>!-->
          <div class="row" id="first">
              <div class="col-sm-4 col-md-4 sidebar">
                  <div id="accordion">
                      <h3>Ensemble List</h3>
                      <div>
                          <!--<div id="bootstraptreeviewSimulations" class=""></div>-->
                          <div id="fancytreeSimulations" class=""></div>
                      </div>
                      <h3>Variable List</h3>
                      <div>
                          <div id="fancytreeVariable" class=""></div>
                      </div>
                      <h3>Variable Selections</h3>
                      <div>
                          <table id="myTable" class="table table-bordered table-sm">
                              <tr id="header">
                                  <th>Variable</th>
                                  <th>Specie</th>
                                  <th>Multivariate</th>
                                  <th>Spatial</th>
                                  <th>Temporal</th>
                              </tr>
                              <!--<tr>
                                  <td>Alfreds Futterkiste</td>
                                  <td>Germany</td>
                              </tr>
                              <tr>
                                  <td>Berglunds snabbkop</td>
                                  <td>Sweden</td>
                              </tr>
                              <tr>
                                  <td>Island Trading</td>
                                  <td>UK</td>
                              </tr>
                              <tr>
                                  <td>Koniglich Essen</td>
                                  <td>Germany</td>
                              </tr>-->
                          </table>
                      </div>
                  </div>

                  <!--<ul class="nav nav-sidebar">
                      <li class="active"><a href="#">Overview <span class="sr-only">(current)</span></a></li>
                      <li><a href="#">Reports</a></li>
                      <li><a href="#">Analytics</a></li>
                      <li><a href="#">Export</a></li>
                  </ul>
                  <ul class="nav nav-sidebar">
                      <li><a href="">Nav item</a></li>
                      <li><a href="">Nav item again</a></li>
                      <li><a href="">One more nav</a></li>
                      <li><a href="">Another nav item</a></li>
                      <li><a href="">More navigation</a></li>
                  </ul>
                  <ul class="nav nav-sidebar">
                      <li><a href="">Nav item again</a></li>
                      <li><a href="">One more nav</a></li>
                      <li><a href="">Another nav item</a></li>
                  </ul>!-->
              </div>
              <div class="col-sm-8 main">
                  <div class="page-header"></div>
                  <!--<h1 class="page-header">Visualization</h1>-->
                      <div id="leftPlots" class="col-sm-6">

                                  <!--<button ng-click="printIrisData()">Click Me!</button>!-->
                              <!--<div id="parCoord" style="height: 100%">
                                  <!--<parcoord data="jsonIrisList"></parcoord>!-->
                                  <!--<splotm data="jsonIrisList"></splotm>
                              </div>-->
                                  <splotm data="multivariateData"
                                          variables="multivariateVariables"></splotm>
                                  <!--<div
                                      id="webglContainer"
                                      ng-webgl
                                      width="canvasWidth"
                                      height="canvasHeight"
                                      fillcontainer="dofillcontainer"
                                      scale="scale"
                                      material-type="materialType"
                                      data="jsonIrisList"
                                  ></div>!-->
                                  <!--<ul>
                                      <li ng-repeat="iris in irisList">
                                        <span>{{iris}}</span>
                                      </li>
                                  </ul>!-->

                          <div class="row">
                              <!--<div id="webgl" style="height: 300px">
                                  <div
                                          id="webglContainer"
                                          ng-webgl
                                          fillcontainer="dofillcontainer"
                                          scale="scale"
                                          material-type="materialType"
                                          data="jsonIrisList"
                                  ></div>
                              </div>-->
                          </div>
                      </div>
                      <div class="col-sm-6">
                          <div id="lineChart">
                              <linechart
                                      data="temporalData"
                                      variables="temporalVariables"></linechart>
                          </div>
                      </div>



              </div>
          </div>



      </div>
  </div>
  <!--<iris></iris>!-->

  <div>Angular seed app: v<span app-version></span></div>

  <!-- In production use:
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/x.x.x/angular.min.js"></script>
  -->
  <script src="bower_components/angular/angular.js"></script>
  <script src="bower_components/angular-route/angular-route.js"></script>
  <script src="bower_components/angular-resource/angular-resource.js"></script>
  <script src="bower_components/three.js/build/three.js"></script>
  <script src="bower_components/jquery-ui/ui/jquery-ui.js"></script>
  <script src="bower_components/fancytree/dist/src/jquery.fancytree.js"></script>
  <script src="bower_components/fancytree/dist/src/jquery.fancytree.dnd.js"></script>
  <script src="bower_components/fancytree/dist/src/jquery.fancytree.edit.js"></script>
  <script src="bower_components/fancytree/dist/src/jquery.fancytree.glyph.js"></script>
  <script src="bower_components/fancytree/dist/src/jquery.fancytree.wide.js"></script>
  <!--<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>!-->
  <script src="app.js"></script>
  <script src="iris-list/iris.module.js"></script>
  <script src="iris-list/iris.component.js"></script>
  <script src="iris-list/d3-vis/parcoord.js"></script>
  <script src="iris-list/d3-vis/splotMatrix.js"></script>
  <script src="iris-list/d3-vis/lineChart.js"></script>
  <script src="iris-list/webgldirective/ngWebgl.js"></script>
  <script src="core/core.module.js"></script>
  <script src="core/iris/iris.module.js"></script>
  <script src="core/iris/iris.service.js"></script>
  <script src="core/ensembleREST/ensemble.module.js"></script>
  <script src="core/ensembleREST/ensemble.service.js"></script>
  <script src="core/d3-service/d3.module.js"></script>
  <script src="core/d3-service/d3.service.js"></script>
  <script src="view1/view1.js"></script>
  <script src="view2/view2.js"></script>
  <script src="components/version/version.js"></script>
  <script src="components/version/version-directive.js"></script>
  <script src="components/version/interpolate-filter.js"></script>
  <script type="text/javascript">

      glyph_opts = {
          map: {
              doc: "glyphicon glyphicon-file",
              docOpen: "glyphicon glyphicon-file",
              checkbox: "glyphicon glyphicon-unchecked",
              checkboxSelected: "glyphicon glyphicon-check",
              checkboxUnknown: "glyphicon glyphicon-share",
              dragHelper: "glyphicon glyphicon-play",
              dropMarker: "glyphicon glyphicon-arrow-right",
              error: "glyphicon glyphicon-warning-sign",
              expanderClosed: "glyphicon glyphicon-menu-right",
              expanderLazy: "glyphicon glyphicon-menu-right",  // glyphicon-plus-sign
              expanderOpen: "glyphicon glyphicon-menu-down",  // glyphicon-collapse-down
              folder: "glyphicon glyphicon-folder-close",
              folderOpen: "glyphicon glyphicon-folder-open",
              loading: "glyphicon glyphicon-refresh glyphicon-spin"
          }
      };
        $(function() {
            var e = document.getElementById("ctrl");
            var $scope = angular.element(e).scope();
            var selectedVariableTable = document.getElementById("myTable").getElementsByTagName('tbody')[0];
            //console.log(selectedVariableTable.children[0].children);
            /*$('#bootstraptreeviewSimulations').treeview({
                data: $scope.bootStrapTreeData,
                showIcon: false,
                showCheckbox: true,
                onNodeChecked: function(event, node) {

                },
                onNodeUnchecked: function(event, node) {

                },
                levels: 1
            });*/

            function onChangeSpatialCheckbox() {
                //console.log(this);
                //console.log("onChangeSpatialCheckbox");
                var checkedValue = this.checked;
                //console.log(checkedValue);
                var pos = -1;
                for(var i = 0; i < $scope.spatialcheckboxes.length; i++) {
                    if(this != $scope.spatialcheckboxes[i]) {
                        if(this.checked && $scope.spatialcheckboxes[i].checked) {
                            $scope.spatialcheckboxes[i].checked = false;
                            $scope.spatialVariables.pop();
                        }
                    } else {
                        $scope.spatialVariables.pop();
                        pos = i;
                    }
                }
                if(this.checked) {
                    $scope.spatialVariables.push($scope.selectedVariables[pos]);
                }
                console.log("Selected spatial variables:");
                console.log($scope.spatialVariables);

            }

            function onChangeMultivariateCheckbox() {
                //console.log(this);
                //console.log("onChangeMultivariateCheckbox");
                var checkedValue = this.checked;
                while($scope.multivariateVariables.length != 0) {
                    $scope.multivariateVariables.pop();
                }
                while($scope.multivariateData.length != 0) {
                    $scope.multivariateData.pop();
                }
                $scope.multivariatecheckboxes.forEach(function (item, i) {
                    if(item.checked) {
                        $scope.multivariateVariables.push($scope.selectedVariables[i]);
                    }
                });
                console.log("Selected multivariate variables:");
                console.log($scope.multivariateVariables);

                var simulationList = $scope.ensembleListJson[$scope.selectedEnsembleIdx].simulations;
                if($scope.multivariateVariables.length > 0)
                    $scope.queryMultivariateData($scope.multivariateVariables, simulationList, 0, 0, 0, 0);

            }

            function onChangeTemporalCheckbox() {
                //console.log(this);
                //console.log("onChangeTemporalCheckbox");
                var checkedValue = this.checked;
                while($scope.temporalVariables.length != 0) {
                    $scope.temporalVariables.pop();
                }

                $scope.temporalcheckboxes.forEach(function (item, i) {
                    if(item.checked) {
                        $scope.temporalVariables.push($scope.selectedVariables[i]);
                    }
                });
                console.log("Selected temporal variables:");
                console.log($scope.temporalVariables);
                var simulationList = $scope.ensembleListJson[$scope.selectedEnsembleIdx].simulations;
                if($scope.temporalVariables.length > 0)
                    $scope.queryTemporalData($scope.temporalVariables[0], simulationList, 0, 0, 0);
                console.log($scope.temporalData);
                /*$scope.$apply(function() {
                    //$scope.temporalData.push(1);
                });*/
            }

            function addRowInTable(obj) {
                /*var tr = document.createElement("tr");
                var var_td1 = document.createElement("td");
                var_td1.appendChild(document.createTextNode(obj.variable));*/

                var newRow = selectedVariableTable.insertRow(selectedVariableTable.rows.length);
                var newVarCell = newRow.insertCell(0);
                var newSpecieCell = newRow.insertCell(1);
                var newMultivariateCell = newRow.insertCell(2);
                var multivariateCheckbox = document.createElement("input");
                multivariateCheckbox.setAttribute("type", "checkbox");
                multivariateCheckbox.onchange = onChangeMultivariateCheckbox;
                var newSpatialCell = newRow.insertCell(3);
                var spatialCheckbox = document.createElement("input");
                spatialCheckbox.setAttribute("type", "checkbox");
                spatialCheckbox.onchange = onChangeSpatialCheckbox;
                var newTemporalCell = newRow.insertCell(4);
                var temporalCheckbox = document.createElement("input");
                temporalCheckbox.setAttribute("type", "checkbox");
                temporalCheckbox.onchange = onChangeTemporalCheckbox;

                newVarCell.appendChild(document.createTextNode(obj.variable));
                newSpecieCell.appendChild(document.createTextNode(obj.specie));
                newMultivariateCell.appendChild(multivariateCheckbox);
                $scope.multivariatecheckboxes.push(multivariateCheckbox);
                newSpatialCell.appendChild(spatialCheckbox);
                $scope.spatialcheckboxes.push(spatialCheckbox);
                newTemporalCell.appendChild(temporalCheckbox);
                $scope.temporalcheckboxes.push(temporalCheckbox);


            }

            $scope.fancytreeEnsemble = $('#fancytreeSimulations').fancytree({
                extensions: ["glyph"],
                checkbox: true,
                selectMode: 1,
                icon: false,
                glyph: glyph_opts,
                source: $scope.ensembleTreeData,
                select: function (event, data) {
                    var selRootNodes = data.tree.getSelectedNodes(true);
                    console.log(selRootNodes);
                    $('#fancytreeVariable').fancytree("getTree").clear();
                    if(selRootNodes.length > 0) {
                        $scope.queryVariableList($scope.ensembleListJson[selRootNodes[0].getIndex()]);
                    }
                }
                //source: $scope.fancytreeData
            });

            $scope.fancytreeEnsembleVariables = $('#fancytreeVariable').fancytree({
                extensions: ["glyph"],
                checkbox: true,
                selectMode: 3,
                icon: false,
                glyph: glyph_opts,
                source: $scope.ensembleVariablesTreeData,
                select: function (event, data) {


                    var selRootNodes = data.tree.getSelectedNodes(true);
                    while($scope.selectedVariables.length != 0) {
                      $scope.selectedVariables.pop();
                      $scope.multivariatecheckboxes.pop();
                      $scope.spatialcheckboxes.pop();
                      $scope.temporalcheckboxes.pop();
                      selectedVariableTable.deleteRow(1);
                    }
                    //$scope.selectedVariables.length = 0;
                    //selectedVariableTable.length = 1;
                    selRootNodes.forEach(function (element) {
                        if(element.getLevel() == 2) {
                            var variable = element.title;
                            if(element.children != null) {
                                element.children.forEach(function (child) {
                                    var specie = child.title;
                                    $scope.selectedVariables.push({
                                        variable: variable,
                                        specie: specie,
                                        id: child.key
                                    });
                                });
                            } else {
                                var specie = "Sediment";
                                $scope.selectedVariables.push({
                                   variable: variable,
                                   specie: specie,
                                    id: element.key
                                });
                            }
                        }
                        else if(element.getLevel() == 3) {
                            var specie = element.title;
                            var variable = element.parent.title;
                            $scope.selectedVariables.push({
                               variable: variable,
                               specie: specie,
                                id: element.key
                            });
                        } else {
                            element.children.forEach(function (child) {
                                var variable = child.title;
                                if(child.children != null) {
                                    child.children.forEach(function (grandson) {
                                        var specie = grandson.title;
                                        $scope.selectedVariables.push({
                                            variable: variable,
                                            specie: specie,
                                            id: child.key
                                        });
                                    });
                                } else {
                                    var specie = "Sediment";
                                    $scope.selectedVariables.push({
                                        variable: variable,
                                        specie: specie,
                                        id: child.key
                                    });
                                }
                            });
                        }
                    });
                    console.log($scope.selectedVariables);
                    $scope.selectedVariables.forEach(function (item) {
                        addRowInTable(item);
                    });
                    //console.log(selRootNodes.getLevel());
                }
            });

            $("#accordion").accordion({
                heightStyle: "content",
                collapsible:true,

                beforeActivate: function(event, ui) {
                    // The accordion believes a panel is being opened
                    if (ui.newHeader[0]) {
                        var currHeader  = ui.newHeader;
                        var currContent = currHeader.next('.ui-accordion-content');
                        // The accordion believes a panel is being closed
                    } else {
                        var currHeader  = ui.oldHeader;
                        var currContent = currHeader.next('.ui-accordion-content');
                    }
                    // Since we've changed the default behavior, this detects the actual status
                    var isPanelSelected = currHeader.attr('aria-selected') == 'true';

                    // Toggle the panel's header
                    currHeader.toggleClass('ui-corner-all',isPanelSelected).toggleClass('accordion-header-active ui-state-active ui-corner-top',!isPanelSelected).attr('aria-selected',((!isPanelSelected).toString()));

                    // Toggle the panel's icon
                    currHeader.children('.ui-icon').toggleClass('ui-icon-triangle-1-e',isPanelSelected).toggleClass('ui-icon-triangle-1-s',!isPanelSelected);

                    // Toggle the panel's content
                    currContent.toggleClass('accordion-content-active',!isPanelSelected)
                    if (isPanelSelected) { currContent.slideUp(); }  else { currContent.slideDown(); }

                    return false; // Cancels the default action
                }
            });
        });





  </script>
</body>
</html>
